<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Test</title>
    <link href=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css rel=stylesheet>
    <link href=https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.20/css/dataTables.bootstrap.min.css rel=stylesheet>
    <script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js></script>
    <script src=https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.20/js/jquery.dataTables.min.js></script>
    <script src=https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.20/js/dataTables.bootstrap.min.js></script>
</head>
<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand">AllWeatherRussiaBot</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#" th:href="@{/users/main}">Личный кабинет</a></li>
                <li><a href="#" th:href="@{/users/charts}">График статистики</a></li>
                <li><a href="/logout">Выйти</a><form style="visibility: hidden" method="get" action="#" th:action="@{/logout}"></form></li>
            </ul>
        </div>
    </div>
</nav>


<br>
<br>
<br>
<br>
<br>

<div class=container>
    <table cellspacing=0 class="table table-bordered table-hover" id=table width=100%>
        <thead>
        <tr>
            <th>Id
            <th>Сообщение
            <th>Язык
            <th>Дата
            <th>Время
        </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
</div>

<br>
<br>
<br>
<br>
<br>

<script>

    $.ajax({
        url: "http://localhost:8084/users/rest/messages",
        dataType: 'json',
        type: 'get',
        cache: false,
        success: function (data) {
            console.log(data);
            let event_data = '';
            $.each(data, function (index, value) {
                console.log(value);
                event_data += '<tr>';
                event_data += '<td>' + value.id + '</td>';
                event_data += '<td>' + value.text + '</td>';
                event_data += '<td>' + value.languageCode + '</td>';
                if (value.date === null) {
                    event_data += '<td>' + ' ' + '</td>';
                    event_data += '<td>' + ' ' + '</td>';
                } else {
                    let date = new Date(value.date * 1000).toLocaleDateString();
                    let time = new Date(value.date * 1000).toLocaleTimeString();
                    event_data += '<td>' + date + '</td>';
                    event_data += '<td>' + time + '</td>';
                }
                event_data += '</tr>';
            });
            $("#table").append(event_data);
            $("#table").DataTable({
                "paging": false,
                "bInfo": false,
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Поиск сообщений"
                }
            });
        },
        error: function () {
            console.log("Data load error");
            location.replace("http://localhost:8084/users/rest/messages");
        }
    });

</script>

</body>
</html>